# 出退勤管理システム 開発手順書

## 概要

本ドキュメントは、要件定義書に基づいた出退勤管理システムの開発手順をまとめたものです。

---

## 1. プロジェクト準備フェーズ（1 週間）

### 1.1 環境セットアップ

- [ ] **アカウント作成**

  - [ ] GitHub アカウント作成・リポジトリ作成
  - [ ] Supabase アカウント作成・プロジェクト作成
  - [ ] Vercel アカウント作成・GitHub 連携
  - [ ] Expo アカウント作成・EAS 設定
  - [ ] Apple Developer Program 登録（$99/年）
  - [ ] Google Play Console 登録（$25 買い切り）

- [ ] **開発環境構築**
  - [ ] Node.js 18 以降のインストール確認
  - [ ] npm/yarn のインストール確認
  - [ ] Git のインストール確認
  - [ ] VS Code（推奨エディタ）のセットアップ

### 1.2 プロジェクト初期化

- [ ] **モノレポ構成の作成**

  ```
  AttendanceDeparture/
  ├── mobile/          # React Native (Expo) アプリ
  ├── web/             # Next.js 管理画面
  ├── packages/        # 共有パッケージ（型定義等）
  └── docs/            # ドキュメント
  ```

- [ ] **モバイルアプリ初期化**

  ```bash
  cd mobile
  npx create-expo-app@latest . --template blank-typescript
  npm install expo-location expo-notifications
  ```

- [ ] **管理画面初期化**

  ```bash
  cd web
  npx create-next-app@latest . --typescript --tailwind --app
  npm install @prisma/client prisma
  npm install @supabase/supabase-js
  ```

- [ ] **共有パッケージ初期化**
  ```bash
  cd packages
  npm init -y
  # 型定義ファイルを作成
  ```

---

## 2. 設計フェーズ（1.5 ヶ月）

### 2.1 データベース設計（1 週間）

- [ ] **Prisma スキーマ設計**

  - [ ] 従業員マスタ（Employee）
  - [ ] 勤怠記録（Attendance）
  - [ ] 休憩記録（Break）
  - [ ] 申請データ（Request）
  - [ ] 承認履歴（Approval）
  - [ ] 年次有給休暇（PaidLeave）
  - [ ] 操作ログ（AuditLog）

- [ ] **Supabase RLS（Row Level Security）ポリシー設計**
  - [ ] 従業員は自分のデータのみ閲覧可能
  - [ ] 管理者は全データ閲覧可能
  - [ ] 打刻データの書き込み権限設定

### 2.2 UI/UX 設計（2 週間）

- [ ] **モバイルアプリ画面設計**

  - [ ] ログイン画面
  - [ ] ホーム画面（打刻ボタン・当日状況）
  - [ ] 勤怠履歴画面（カレンダー表示）
  - [ ] 申請画面（打刻修正・休暇申請）
  - [ ] 申請履歴画面
  - [ ] 設定画面

- [ ] **管理画面画面設計**

  - [ ] ログイン画面
  - [ ] ダッシュボード
  - [ ] 勤怠管理一覧
  - [ ] 申請承認画面
  - [ ] 集計・レポート画面
  - [ ] 基本設定画面

- [ ] **デザインシステム定義**
  - [ ] カラーパレット
  - [ ] タイポグラフィ
  - [ ] コンポーネントライブラリ

### 2.3 API 設計（1 週間）

- [ ] **エンドポイント設計**

  - [ ] 認証 API（Supabase Auth 使用）
  - [ ] 打刻 API（出勤・退勤・休憩）
  - [ ] 勤怠取得 API
  - [ ] 申請 API（作成・取得・更新）
  - [ ] 承認 API
  - [ ] 集計 API（月次・年次）
  - [ ] CSV 出力 API

- [ ] **データフロー設計**
  - [ ] 直接 Supabase アクセス（読み取り・リアルタイム）
  - [ ] Next.js API 経由（書き込み・複雑な処理）

### 2.4 ビジネスロジック設計（1 週間）

- [ ] **労働時間計算ロジック**

  - [ ] 実労働時間 = 終業時刻 - 始業時刻 - 休憩時間
  - [ ] 時間外労働時間 = 実労働時間 - 所定労働時間（8 時間）
  - [ ] 深夜労働時間（22:00〜5:00）の計算
  - [ ] 休日労働時間の計算
  - [ ] 週の労働時間集計

- [ ] **法令チェックロジック**

  - [ ] 月 45 時間上限チェック
  - [ ] 年 360 時間上限チェック
  - [ ] 月 80 時間（過労死ライン）チェック
  - [ ] 週 40 時間上限チェック
  - [ ] 勤務間インターバル 11 時間チェック
  - [ ] 法定休憩時間チェック（6h 超 →45 分、8h 超 →1 時間）

- [ ] **アラート・警告ロジック**
  - [ ] 打刻忘れアラート
  - [ ] 時間外労働警告（45 時間接近・超過）
  - [ ] 過労死ライン警告（80 時間超過）

---

## 3. 開発フェーズ（4.5 ヶ月）

### 3.1 基盤開発（2 週間）

#### 3.1.1 データベース構築

- [ ] **Prisma マイグレーション実行**

  ```bash
  cd web
  npx prisma init
  # schema.prismaを編集
  npx prisma migrate dev --name init
  npx prisma generate
  ```

- [ ] **Supabase 接続設定**
  - [ ] 環境変数設定（DATABASE_URL, SUPABASE_URL, SUPABASE_KEY）
  - [ ] Supabase クライアント初期化

#### 3.1.2 認証機能実装

- [ ] **Supabase Auth 設定**

  - [ ] メール・パスワード認証
  - [ ] JWT トークン管理
  - [ ] セッション管理

- [ ] **認証ミドルウェア実装**
  - [ ] モバイルアプリ：認証状態管理
  - [ ] 管理画面：認証ガード実装

#### 3.1.3 共通コンポーネント開発

- [ ] **モバイルアプリ共通コンポーネント**

  - [ ] ボタンコンポーネント
  - [ ] カードコンポーネント
  - [ ] リストコンポーネント
  - [ ] ローディングコンポーネント

- [ ] **管理画面共通コンポーネント**
  - [ ] レイアウトコンポーネント
  - [ ] テーブルコンポーネント
  - [ ] フォームコンポーネント
  - [ ] モーダルコンポーネント

### 3.2 モバイルアプリ開発（2.5 ヶ月）

#### 3.2.1 打刻機能（3 週間）

- [ ] **GPS 位置情報取得**

  - [ ] expo-location の設定
  - [ ] 位置情報取得処理
  - [ ] 位置情報の精度チェック

- [ ] **出勤打刻**

  - [ ] 出勤ボタン UI
  - [ ] 打刻 API 呼び出し
  - [ ] 成功・失敗時のフィードバック
  - [ ] 打刻時刻の表示

- [ ] **退勤打刻**

  - [ ] 退勤ボタン UI
  - [ ] 打刻 API 呼び出し
  - [ ] 当日の労働時間計算・表示

- [ ] **休憩打刻**
  - [ ] 休憩開始ボタン
  - [ ] 休憩終了ボタン
  - [ ] 休憩時間の累計表示

#### 3.2.2 勤怠表示機能（2 週間）

- [ ] **当日勤務状況表示**

  - [ ] 出勤時刻表示
  - [ ] 現在の勤務時間（リアルタイム更新）
  - [ ] 休憩時間表示
  - [ ] 予想残業時間表示

- [ ] **月間勤怠表示**
  - [ ] カレンダー形式の勤怠履歴
  - [ ] 日次労働時間表示
  - [ ] 月間労働時間合計
  - [ ] 時間外労働時間（当月）
  - [ ] 警告表示（45 時間接近等）

#### 3.2.3 申請機能（2 週間）

- [ ] **打刻修正申請**

  - [ ] 申請フォーム（日付・時刻・理由）
  - [ ] 申請 API 呼び出し
  - [ ] 申請状況確認画面

- [ ] **休暇申請**
  - [ ] 有給休暇申請フォーム
  - [ ] その他休暇申請フォーム
  - [ ] 申請履歴・承認状況確認

#### 3.2.4 通知機能（1 週間）

- [ ] **プッシュ通知設定**

  - [ ] expo-notifications の設定
  - [ ] 通知権限リクエスト

- [ ] **通知タイプ実装**
  - [ ] 打刻忘れアラート
  - [ ] 申請承認・却下通知
  - [ ] 残業時間警告

#### 3.2.5 その他機能（1 週間）

- [ ] **設定画面**

  - [ ] プロフィール表示
  - [ ] ログアウト機能

- [ ] **エラーハンドリング**
  - [ ] ネットワークエラー処理
  - [ ] バリデーションエラー表示

### 3.3 管理画面開発（2 ヶ月）

#### 3.3.1 ダッシュボード（2 週間）

- [ ] **リアルタイム勤怠状況**

  - [ ] 本日の出勤者リスト
  - [ ] 現在勤務中の人数
  - [ ] 未打刻者リスト（最優先アラート）
  - [ ] 遅刻・早退者表示

- [ ] **警告・アラート一覧**
  - [ ] 時間外労働 45 時間超過者
  - [ ] 時間外労働 80 時間超過者（過労死ライン）
  - [ ] 勤務間インターバル 11 時間未満
  - [ ] 週 40 時間超過者
  - [ ] 未打刻・打刻漏れ

#### 3.3.2 勤怠管理（3 週間）

- [ ] **勤怠一覧画面**

  - [ ] 日次・週次・月次表示切替
  - [ ] 全従業員の勤怠データ表示
  - [ ] 異常値のハイライト表示
  - [ ] フィルター・検索機能

- [ ] **詳細労働時間管理**

  - [ ] 所定労働時間表示
  - [ ] 実労働時間表示
  - [ ] 時間外労働時間（法定内・法定外）
  - [ ] 深夜労働時間（22:00〜5:00）
  - [ ] 休日労働時間
  - [ ] 週の労働時間

- [ ] **休憩時間管理**

  - [ ] 休憩時間の表示・編集
  - [ ] 法定休憩時間チェック（6h 超 →45 分、8h 超 →1 時間）
  - [ ] 実労働時間の自動再計算

- [ ] **打刻データ編集**
  - [ ] 手動での打刻修正
  - [ ] 修正履歴の完全保存（改ざん防止）
  - [ ] 修正理由の記録必須

#### 3.3.3 申請管理（2 週間）

- [ ] **申請承認機能**
  - [ ] 休暇申請の承認・却下
  - [ ] 打刻修正申請の承認・却下
  - [ ] 承認待ち一覧
  - [ ] 承認履歴

#### 3.3.4 集計・出力（2 週間）

- [ ] **月次集計レポート**

  - [ ] 従業員別の月間サマリー
  - [ ] 時間外労働時間ランキング
  - [ ] 未打刻日数
  - [ ] 遅刻・早退回数

- [ ] **時間外労働管理**

  - [ ] 月次進捗（45 時間上限）
  - [ ] 年間進捗（360 時間上限）
  - [ ] 複数月平均（2〜6 ヶ月で 80 時間以内）
  - [ ] グラフ表示

- [ ] **CSV エクスポート**
  - [ ] 給与計算用フォーマット
  - [ ] カスタマイズ可能な項目選択
  - [ ] 期間指定出力
  - [ ] 5 年間のデータ保持対応

#### 3.3.5 基本設定（2 週間）

- [ ] **従業員マスタ管理**

  - [ ] 従業員情報登録・編集
  - [ ] 所属部署設定
  - [ ] 勤務形態（固定時間、フレックス、シフト）
  - [ ] 所定労働時間設定

- [ ] **勤務パターン設定**

  - [ ] 始業・終業時刻
  - [ ] 休憩時間設定
  - [ ] 法定休日設定

- [ ] **年次有給休暇管理**
  - [ ] 付与日数設定
  - [ ] 取得日数・残日数表示
  - [ ] 年 5 日取得義務の進捗管理

### 3.4 API 開発（並行して実施）

#### 3.4.1 打刻 API（1 週間）

- [ ] 出勤打刻エンドポイント
- [ ] 退勤打刻エンドポイント
- [ ] 休憩開始・終了エンドポイント
- [ ] GPS 位置情報の保存
- [ ] 労働時間の自動計算

#### 3.4.2 勤怠取得 API（1 週間）

- [ ] 当日勤怠取得
- [ ] 月間勤怠取得
- [ ] 期間指定勤怠取得

#### 3.4.3 申請 API（1 週間）

- [ ] 申請作成 API
- [ ] 申請取得 API
- [ ] 申請更新 API

#### 3.4.4 承認 API（1 週間）

- [ ] 承認処理 API
- [ ] 承認履歴取得 API

#### 3.4.5 集計 API（2 週間）

- [ ] 月次集計 API
- [ ] 年次集計 API
- [ ] CSV 出力 API

---

## 4. 統合フェーズ（2 週間）

### 4.1 モバイル ⇄API 連携

- [ ] **API 接続テスト**

  - [ ] 認証フロー確認
  - [ ] 打刻 API 動作確認
  - [ ] 勤怠取得 API 動作確認
  - [ ] 申請 API 動作確認

- [ ] **エラーハンドリング確認**
  - [ ] ネットワークエラー時の挙動
  - [ ] タイムアウト処理
  - [ ] リトライ機能

### 4.2 Supabase 統合テスト

- [ ] **RLS ポリシーテスト**

  - [ ] 従業員権限でのアクセステスト
  - [ ] 管理者権限でのアクセステスト

- [ ] **リアルタイム機能テスト**
  - [ ] 勤怠データのリアルタイム更新確認

### 4.3 データ整合性確認

- [ ] **労働時間計算の正確性確認**

  - [ ] 実労働時間計算
  - [ ] 時間外労働時間計算
  - [ ] 深夜労働時間計算
  - [ ] 週の労働時間集計

- [ ] **法令チェックの動作確認**
  - [ ] 各上限チェックの動作確認
  - [ ] アラート発火の確認

---

## 5. テストフェーズ（1 ヶ月）

### 5.1 単体テスト（2 週間）

- [ ] **モバイルアプリ単体テスト**

  - [ ] 各コンポーネントのテスト
  - [ ] ビジネスロジックのテスト

- [ ] **管理画面単体テスト**

  - [ ] 各コンポーネントのテスト
  - [ ] API エンドポイントのテスト

- [ ] **労働時間計算ロジックのテスト**
  - [ ] 様々なシナリオでの計算結果確認

### 5.2 結合テスト（1 週間）

- [ ] **モバイルアプリ ⇄API 結合テスト**
- [ ] **管理画面 ⇄API 結合テスト**
- [ ] **Supabase 連携テスト**

### 5.3 システムテスト（1 週間）

- [ ] **エンドツーエンドテスト**

  - [ ] 打刻フロー全体のテスト
  - [ ] 申請フロー全体のテスト
  - [ ] 承認フロー全体のテスト

- [ ] **パフォーマンステスト**

  - [ ] 打刻処理：3 秒以内
  - [ ] 画面表示：5 秒以内
  - [ ] 月次レポート生成：30 秒以内

- [ ] **セキュリティテスト**
  - [ ] 認証・認可の動作確認
  - [ ] RLS ポリシーの動作確認
  - [ ] HTTPS 通信の確認

### 5.4 UAT（ユーザー受入テスト）（1 週間）

- [ ] **テストユーザーでの動作確認**

  - [ ] 従業員ユーザーでのテスト
  - [ ] 管理者ユーザーでのテスト

- [ ] **フィードバック収集・修正**

---

## 6. リリース準備フェーズ（2 週間）

### 6.1 本番環境構築

- [ ] **Supabase 本番環境設定**

  - [ ] 本番データベース作成
  - [ ] RLS ポリシー適用
  - [ ] バックアップ設定

- [ ] **Vercel 本番環境設定**

  - [ ] 本番環境変数設定
  - [ ] カスタムドメイン設定（必要に応じて）

- [ ] **EAS 本番環境設定**
  - [ ] 本番ビルド設定
  - [ ] 証明書設定（iOS）

### 6.2 アプリストア申請

- [ ] **iOS App Store 申請**

  - [ ] App Store Connect でのアプリ登録
  - [ ] スクリーンショット・説明文作成
  - [ ] プライバシーポリシー作成
  - [ ] TestFlight でのテスト配信
  - [ ] 本番申請・審査提出

- [ ] **Google Play Store 申請**
  - [ ] Google Play Console でのアプリ登録
  - [ ] スクリーンショット・説明文作成
  - [ ] プライバシーポリシー作成
  - [ ] 内部テスト・クローズドテスト
  - [ ] 本番申請・審査提出

### 6.3 データ移行

- [ ] **既存データの移行（ある場合）**
  - [ ] 従業員マスタデータ移行
  - [ ] 既存勤怠データ移行（ある場合）

### 6.4 ドキュメント作成

- [ ] **ユーザーマニュアル作成**

  - [ ] 従業員向けマニュアル
  - [ ] 管理者向けマニュアル

- [ ] **運用マニュアル作成**
  - [ ] システム管理者向けマニュアル
  - [ ] トラブルシューティングガイド

---

## 7. MVP 運用開始

### 7.1 リリース

- [ ] **本番リリース**
  - [ ] モバイルアプリの公開
  - [ ] 管理画面の公開
  - [ ] ユーザーへの案内

### 7.2 運用開始

- [ ] **監視設定**

  - [ ] エラーログ監視
  - [ ] パフォーマンス監視
  - [ ] アラート設定

- [ ] **サポート体制**
  - [ ] 問い合わせ窓口の設置
  - [ ] よくある質問（FAQ）の作成

### 7.3 フィードバック収集

- [ ] **ユーザーフィードバックの収集**
- [ ] **改善点の洗い出し**
- [ ] **フェーズ 2 開発計画の策定**

---

## 8. フェーズ 2 開発（MVP 後 3 ヶ月以内）

### 8.1 機能強化

- [ ] 36 協定管理
- [ ] シフト管理機能
- [ ] 部署・チーム管理
- [ ] レポート機能強化
- [ ] 承認ワークフロー設定
- [ ] 通知設定のカスタマイズ
- [ ] 遅刻・早退の理由管理

---

## 9. フェーズ 3 開発（運用安定後）

### 9.1 拡張機能

- [ ] GPS 打刻範囲制限
- [ ] 顔写真撮影（オプション）
- [ ] オンライン通話機能
- [ ] 外部システム連携 API
- [ ] 多言語対応
- [ ] 高度な分析機能

---

## 開発時の注意事項

### 法令遵守

- 労働基準法に準拠した実装を必ず行う
- 5 年間のデータ保持を確実に実装
- 客観的な記録（GPS 位置情報）を必須とする

### セキュリティ

- 全ての通信を HTTPS で暗号化
- パスワードはハッシュ化して保存
- RLS ポリシーで適切なアクセス制御
- 操作ログを必ず記録

### パフォーマンス

- 打刻処理は 3 秒以内を目標
- 画面表示は 5 秒以内を目標
- 適切なインデックス設定

### ユーザビリティ

- 直感的な UI/UX 設計
- エラーメッセージは分かりやすく
- ローディング状態を明確に表示

---

## 参考リソース

- [Expo Documentation](https://docs.expo.dev/)
- [Next.js Documentation](https://nextjs.org/docs)
- [Prisma Documentation](https://www.prisma.io/docs)
- [Supabase Documentation](https://supabase.com/docs)
- [Vercel Documentation](https://vercel.com/docs)
- [労働基準法](https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/koyou_roudou/roudoukijun/index.html)
